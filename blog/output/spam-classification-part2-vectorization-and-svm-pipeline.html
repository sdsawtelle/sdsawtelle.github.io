<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>Evening Session</title>

            <link href="sdsawtelle.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Evening Session Full Atom Feed" />
            <link href="sdsawtelle.github.io/feeds/python.atom.xml" type="application/atom+xml" rel="alternate" title="Evening Session Categories Atom Feed" />

        <!-- Bootstrap Core CSS -->
        <link href="./theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="./theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="./theme/css/code_blocks/github" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="python" />
        <meta name="tags" contents="machine learning" />
        <meta name="tags" contents="svm" />
        <meta name="tags" contents="pipeline" />
        <meta name="tags" contents="spam" />
        <meta name="tags" contents="classification" />


			<meta property="og:locale" content="en">
		<meta property="og:site_name" content="Evening Session">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="./spam-classification-part2-vectorization-and-svm-pipeline.html">
	<meta property="og:title" content="Spam Part II: Classifying with a Vectorization and SVM Pipeline">
	<meta property="og:description" content="">
	<meta property="og:image" content="./">
	<meta property="article:published_time" content="2016-12-07 13:30:00-05:00">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sdsawtelle.github.io">SonyaSawtelle</a>
				<a class="navbar-brand" href="https://sdsawtelle.github.io/blog/output/index.html">All Posts</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('./theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Spam Part II: Classifying with a Vectorization and SVM Pipeline</h1>
                        <span class="meta">Posted by
                                <a href="./author/sonya-sawtelle.html">Sonya Sawtelle</a>
                             on Wed 07 December 2016
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <style type="text/css">/*!
*
* IPython notebook
*
*/.ansibold{font-weight:700}.ansiblack{}.ansired{color:#8b0000}.ansigreen{6400}.ansiyellow{color:#c4a000}.ansiblue{8b}.ansipurple{color:#9400d3}.ansicyan{color:#4682b4}.ansigray{color:gray}.ansibgblack{background-}.ansibgred{background-color:red}.ansibggreen{background-color:green}.ansibgyellow{background-color:#ff0}.ansibgblue{background-f}.ansibgpurple{background-color:#ff00ff}.ansibgcyan{background-ff}.ansibggray{background-color:gray}div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;border-radius:2px;box-sizing:border-box;-moz-box-sizing:border-box;border-width:thin;border-style:solid;width:100%;padding:5px;margin:0;outline:0}div.cell.selected{border-color:#ababab}@media print{div.cell.selected{border-color:transparent}}.edit_mode div.cell.selected{border-color:green}.prompt{min-width:14ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}@-moz-document url-prefix(){div.inner_cell{overflow-x:hidden}}div.input_area{border:1px solid #cfcfcf;border-radius:2px;background:#f7f7f7;line-height:1.21429em}div.prompt:empty{padding-top:0;padding-bottom:0}div.unrecognized_cell{padding:5px 5px 5px 0;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.unrecognized_cell .inner_cell{border-radius:2px;padding:5px;font-weight:700;color:red;border:1px solid #cfcfcf;background:#eaeaea}div.unrecognized_cell .inner_cell a,div.unrecognized_cell .inner_cell a:hover{color:inherit;text-decoration:none}@media (max-width:540px){.prompt{text-align:left}div.unrecognized_cell>div.prompt{display:none}}div.code_cell{}div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.input{-webkit-box-orient:vertical;-moz-box-orient:vertical;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.input_prompt{color:navy;border-top:1px solid transparent}div.input_area>div.highlight{margin:.4em;border:none;padding:0;background-color:transparent}div.input_area>div.highlight>pre{margin:0;border:none;padding:0;background-color:transparent}.CodeMirror{line-height:1.21429em;font-size:14px;height:auto;background:0 0}.CodeMirror-scroll{overflow-y:hidden;overflow-x:auto}.CodeMirror-lines{padding:.4em}.CodeMirror-linenumber{padding:0 8px 0 4px}.CodeMirror-gutters{border-bottom-left-radius:2px;border-top-left-radius:2px}.CodeMirror pre{padding:0;border:0;border-radius:0}.highlight-base,.highlight-variable{}.highlight-variable-2{color:#1a1a1a}.highlight-variable-3{color:#333}.highlight-string{color:#BA2121}.highlight-comment{color:#408080;font-style:italic}.highlight-number{80}.highlight-atom{color:#88F}.highlight-keyword{color:green;font-weight:700}.highlight-builtin{color:green}.highlight-error{color:red}.highlight-operator{color:#A2F;font-weight:700}.highlight-meta{color:#A2F}.highlight-def{f}.highlight-string-2{color:#f50}.highlight-qualifier{color:#555}.highlight-bracket{color:#997}.highlight-tag{color:#170}.highlight-attribute{c}.highlight-header{f}.highlight-quote{90}.highlight-link{c}.cm-s-ipython span.cm-keyword{color:green;font-weight:700}.cm-s-ipython span.cm-atom{color:#88F}.cm-s-ipython span.cm-number{80}.cm-s-ipython span.cm-def{f}.cm-s-ipython span.cm-variable{}.cm-s-ipython span.cm-operator{color:#A2F;font-weight:700}.cm-s-ipython span.cm-variable-2{color:#1a1a1a}.cm-s-ipython span.cm-variable-3{color:#333}.cm-s-ipython span.cm-comment{color:#408080;font-style:italic}.cm-s-ipython span.cm-string{color:#BA2121}.cm-s-ipython span.cm-string-2{color:#f50}.cm-s-ipython span.cm-meta{color:#A2F}.cm-s-ipython span.cm-qualifier{color:#555}.cm-s-ipython span.cm-builtin{color:green}.cm-s-ipython span.cm-bracket{color:#997}.cm-s-ipython span.cm-tag{color:#170}.cm-s-ipython span.cm-attribute{c}.cm-s-ipython span.cm-header{f}.cm-s-ipython span.cm-quote{90}.cm-s-ipython span.cm-link{c}.cm-s-ipython span.cm-error{color:red}.cm-s-ipython span.cm-tab{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=')right no-repeat}div.output_wrapper{display:-webkit-box;-webkit-box-align:stretch;display:-moz-box;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;z-index:1}div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:2px;-webkit-box-shadow:inset 0 2px 8px rgba(0,0,0,.8);box-shadow:inset 0 2px 8px rgba(0,0,0,.8);display:block}div.output_collapsed{margin:0;padding:0;display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.out_prompt_overlay{height:100%;padding:0 .4em;position:absolute;border-radius:2px}div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000;box-shadow:inset 0 0 1px #000;background:rgba(240,240,240,.5)}div.output_prompt{color:#8b0000}div.output_area{padding:0;page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.output_area .MathJax_Display{text-align:left!important}div.output_area div.output_area img,div.output_area svg{max-width:100%;height:auto}div.output_area img.unconfined,div.output_area svg.unconfined{max-width:none}.output{display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}@media (max-width:540px){div.output_area{-webkit-box-orient:vertical;-moz-box-orient:vertical;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.output_area pre{margin:0;padding:0;border:0;vertical-align:baseline;background-color:transparent;border-radius:0}div.output_subarea{overflow-x:auto;padding:.4em;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1;max-width:calc(100% - 14ex)}div.output_text{text-align:left;line-height:1.21429em}div.output_stderr{background:#fdd}div.output_latex{text-align:left}div.output_javascript:empty{padding:0}.js-error{color:#8b0000}div.raw_input_container{font-family:monospace;padding-top:5px}span.raw_input_prompt{}input.raw_input{font-family:inherit;font-size:inherit;color:inherit;width:auto;vertical-align:baseline;padding:0 .25em;margin:0 .25em}input.raw_input:focus{box-shadow:none}p.p-space{margin-bottom:10px}div.output_unrecognized{padding:5px;font-weight:700;color:red}div.output_unrecognized a,div.output_unrecognized a:hover{color:inherit;text-decoration:none}.rendered_html{}.rendered_html :link,.rendered_html :visited,.rendered_html h1:first-child{margin-top:.538em}.rendered_html h2:first-child{margin-top:.636em}.rendered_html h3:first-child{margin-top:.777em}.rendered_html h4:first-child,.rendered_html h5:first-child,.rendered_html h6:first-child{margin-top:1em}.rendered_html *+ol,.rendered_html *+ul{margin-top:1em}.rendered_html *+table{margin-top:1em}.rendered_html *+p{margin-top:1em}.rendered_html *+img{margin-top:1em}div.text_cell{display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.text_cell>div.prompt{display:none}}div.text_cell_render{outline:0;resize:none;width:inherit;border-style:none;padding:.5em .5em .5em .4em;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}a.anchor-link:link{text-decoration:none;padding:0 20px;visibility:hidden}h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible}.text_cell.rendered .input_area{display:none}.text_cell.rendered .text_cell.unrendered .text_cell_render{display:none}.cm-header-1,.cm-header-2,.cm-header-3,.cm-header-4,.cm-header-5,.cm-header-6{font-weight:700;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}.cm-header-1{font-size:185.7%}.cm-header-2{font-size:157.1%}.cm-header-3{font-size:128.6%}.cm-header-4{font-size:110%}.cm-header-5,.cm-header-6{font-size:100%;font-style:italic}</style>
<style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="In-which-I-help-you-decide-if-cash4u@freestuff.net-is-legit-or-not.">In which I help you decide if cash4u@freestuff.net is legit or not.<a class="anchor-link" href="#In-which-I-help-you-decide-if-cash4u@freestuff.net-is-legit-or-not.">¶</a></h1><p>Week 7 of Andrew Ng's ML course on Coursera introduces the Support Vector Machine algorithm and challenges us to use it for classifying email as spam or ham. Here I use the <a href="https://spamassassin.apache.org/publiccorpus/">SpamAssassin public corpus</a> to build an SVM spam email classifier in order to learn about the relevant python tools. <a href="http://sdsawtelle.github.io/blog/output/spam-classification-text-processing.html">Part I</a> focused on the preprocessing of individual emails, but now I'm going to actually do some machine learning.</p>
<blockquote><h2 id="Tools-Covered:">Tools Covered:<a class="anchor-link" href="#Tools-Covered:">¶</a></h2><ul>
<li><code>CountVectorizer</code> for mapping text data to numeric word occurrence vectors</li>
<li><code>tfidfTransformer</code> for normalizing word occurrence vectors </li>
<li><code>Pipeline</code> for chaining together transformer (preprocessing, feature extraction) and estimator steps</li>
<li><code>GridSearchCV</code> for optimizing over the metaparameters of an estimator or pipeline</li>
</ul>
</blockquote>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Set up environment</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">nltk.stem.snowball</span> <span class="k">import</span> <span class="n">SnowballStemmer</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="k">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="k">import</span> <span class="n">stopwords</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s">"stopwords"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">snips</span> <span class="k">as</span> <span class="nn">snp</span>  <span class="c"># my snippets</span>
<span class="n">snp</span><span class="o">.</span><span class="n">prettyplot</span><span class="p">(</span><span class="n">matplotlib</span><span class="p">)</span>  <span class="c"># my aesthetic preferences for plotting</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Sonya\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cd</span> <span class="n">hw</span><span class="o">-</span><span class="n">wk7</span><span class="o">-</span><span class="n">spam</span><span class="o">-</span><span class="n">svm</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>C:\Users\Sonya\Box Sync\Projects\course-machine-learning\hw-wk7-spam-svm
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Quick-Look-at-the-Data">Quick Look at the Data<a class="anchor-link" href="#Quick-Look-at-the-Data">¶</a></h1><p>In <a href="http://sdsawtelle.github.io/blog/output/spam-classification-text-processing.html">Part I</a> of this post I created a corpus of raw email bodies, and fully processed email bodies, together with the vector of ground truth for these emails ($y=0$ for ham). The processed emails have had all stop words removed and all words stemmed to their root.</p>
<p>I'll first read in these pickled objects and give a quick preview of them:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"easyham_and_spam_corpus_raw_and_processed_and_y.pickle"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="n">emails_raw</span><span class="p">,</span> <span class="n">emails_processed</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">myfile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">emails_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[4]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>&apos;\n    Date:        Wed, 21 Aug 2002 10:54:46 -0500\n    From:        Chris Garrigues <cwg-dated-1030377287.06fa6d@deepeddy.com>\n    Message-ID:  <1029945287.4797.TMDA@deepeddy.vircio.com>\n\n\n  | I can\&apos;t reproduce this error.\n\nFor me it is very repeatable... (like every time, without fail).\n\nThis is the debug log of the pick happening ...\n\n18:19:03 Pick_It {exec pick +inbox -list -lbrace -lbrace -subject ftp -rbrace -rbrace} {4852-4852 -sequence mercury}\n18:19:03 exec pick +inbox -list -lbrace -lbrace -subject ftp -rbrace -rbrace 4852-4852 -sequence mercury\n18:19:04 Ftoc_PickMsgs {{1 hit}}\n18:19:04 Marking 1 hits\n18:19:04 tkerror: syntax error in expression "int ...\n\nNote, if I run the pick command by hand ...\n\ndelta$ pick +inbox -list -lbrace -lbrace -subject ftp -rbrace -rbrace  4852-4852 -sequence mercury\n1 hit\n\nThat\&apos;s where the "1 hit" comes from (obviously).  The version of nmh I\&apos;m\nusing is ...\n\ndelta$ pick -version\npick -- nmh-1.0.4 [compiled on fuchsia.cs.mu.OZ.AU at Sun Mar 17 14:55:56 ICT 2002]\n\nAnd the relevant part of my .mh_profile ...\n\ndelta$ mhparam pick\n-seq sel -list\n\n\nSince the pick command works, the sequence (actually, both of them, the\none that\&apos;s explicit on the command line, from the search popup, and the\none that comes from .mh_profile) do get created.\n\nkre\n\nps: this is still using the version of the code form a day ago, I haven\&apos;t\nbeen able to reach the cvs repository today (local routing issue I think).\n\n\n\n_______________________________________________\nExmh-workers mailing list\nExmh-workers@redhat.com\nhttps://listman.redhat.com/mailman/listinfo/exmh-workers\n\n&apos;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">emails_processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[23]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>&apos;date wed aug chris garrigu messag id cant reproduc error repeat like everi time without fail debug log pick happen pick exec pick inbox list lbrace lbrace subject ftp rbrace rbrace sequenc mercuri exec pick inbox list lbrace lbrace subject ftp rbrace rbrace sequenc mercuri ftoc pickmsg hit mark hit tkerror syntax error express int note run pick command hand delta pick inbox list lbrace lbrace subject ftp rbrace rbrace sequenc mercuri hit that hit come obvious version nmh im use delta pick version pick nmh compil fuchsia cs mu oz au sun mar ict relev part mh profil delta mhparam pick seq sel list sinc pick command work sequenc actual one that explicit command line search popup one come mh profil get creat kre ps still use version code form day ago havent abl reach cvs repositori today local rout issu think exmh worker mail list&apos;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Mapping-Text-to-Vectors">Mapping Text to Vectors<a class="anchor-link" href="#Mapping-Text-to-Vectors">¶</a></h1><p>Any classification algorithm we might want to use for this task is going to expect numeric input features, so we can't just feed it our email strings. Instead we'll map each email to a vector whose elements reflect the presence of specific words in that email. For instance, we could map to a vector $x$ where $x_1 = $ (# of times the word 'money' appears), $x_2 = $ (# of times the word 'stop' appears) etc. This mapping constitutes a "Bag of Words" approach because no information about the relative position of words in the email is retained. The words that we count to construct the elements of this vector constitute our <strong>Vocab List</strong>, in the above our vocab list would be ['money', 'stop']. <strong>Each vocab word leads to a feature that reflects the presence of that word in an email.</strong></p>
<p>These numeric vectors can reflect either the binary presence of the words or the number of occurrences of the words. Let me quote directly from a <a href="http://scikit-learn.org/stable/tutorial/text_analytics/working_with_text_data.html">wonderful sklearn tutorial</a> on the topic of occurrence count features:</p>
<blockquote><p>Occurrence count is a good start but there is an issue: longer documents will have higher average count values than shorter documents, even though they might talk about the same topics.
To avoid these potential discrepancies it suffices to divide the number of occurrences of each word in a document by the total number of words in the document: these new features are called tf for <strong>"Term Frequencies"</strong>
Another refinement on top of tf is to downscale weights for words that occur in many documents in the corpus and are therefore less informative than those that occur only in a smaller portion of the corpus.
This downscaling is called <strong>tf–idf for “Term Frequency times Inverse Document Frequency”</strong></p>
</blockquote>
<p>The sklearn docs also have <a href="http://scikit-learn.org/stable/modules/feature_extraction.html#tfidf-term-weighting">more info on tf-idf</a> in the User Guide.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Creating-a-&quot;Vocab-List&quot;-of-Selected-Words">Creating a "Vocab List" of Selected Words<a class="anchor-link" href="#Creating-a-&quot;Vocab-List&quot;-of-Selected-Words">¶</a></h1><p>If we make a list of all the words from all the emails then it will have a very large number of unique elements, but some of those words don't appear very often and thus won't be very useful for us. Instead its common to make your Vocab List from only the significantly common words. Let's explore what our vocab list might look like:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">flatlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">emails_processed</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">email</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)]</span>  <span class="c"># A flat list of all words from all emails</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Count number of appearances of each word and store as dictionary</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="n">counts_dict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">flatlist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I want to get a sense of the distribution over word-frequencies. The word "number" is going to be vastly more common than any other word and definitely any word that only appears once or twice in the whole email corpus is not going to help us much, so we'll ignore those:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">snp</span><span class="o">.</span><span class="n">labs</span><span class="p">(</span><span class="s">"Occurrence Count Value"</span><span class="p">,</span> <span class="s">"Frequency of Occurrence Count Value"</span><span class="p">,</span> <span class="s">"Frequency of Occurrence Count :)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">counts_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">num</span> <span class="o">></span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">num</span> <span class="o"><</span> <span class="mi">12000</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[9]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>(50, 1000)</pre>
</div>
</div>
<div class="output_area"><div class="prompt"></div>
<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
RU5ErkJggg==
">
</img></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets get a sense of what our vocab list would be like if we only used words who appeared a hundred or more times:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">vocablist</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts_dict</span> <span class="k">if</span> <span class="n">counts_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">></span> <span class="mi">100</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">vocablist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[8]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>877</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">vocablist</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[10]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>[&apos;billion&apos;, &apos;ad&apos;, &apos;togeth&apos;, &apos;propos&apos;, &apos;generat&apos;, &apos;stuff&apos;, &apos;edit&apos;]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This criteria of demanding a frequency of at least 100 appearances would give us a vocab list of 865 words to use to define our feature space.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Vectorizing-the-Emails">Vectorizing the Emails<a class="anchor-link" href="#Vectorizing-the-Emails">¶</a></h1><p><strong>Given the corpus of processed emails and Vocab List of selected words, we want to map each email to a numeric vector that reflects the occurrence (or frequency) of different vocab words.</strong> The tool in sklearn that helps us do this is <code>CountVectorizer</code>. It is a class that tokenizes input text and converts it into a numeric vector. Let's do an example using the vocab list we generated above and assuming we want our vectors to reflect actual word count, rather than binary presence of the word (if you want binary, then specify kwarg <code>binary=True</code>):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="k">import</span> <span class="n">CountVectorizer</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Specify our vocab list, and use processed email bodies</span>
<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">vocablist</span><span class="p">)</span>  
<span class="n">X</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">emails_processed</span><span class="p">)</span>
<span class="n">X</span> 
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[11]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><3046x877 sparse matrix of type &apos;<class &amp;apos;numpy.int64&amp;apos;>&apos;
	with 150787 stored elements in Compressed Sparse Row format></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">X</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="c"># The number of times the 30th word appears in the 30th email</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[22]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>3</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-a-Custom-Preprocessing-Function">Using a Custom Preprocessing Function<a class="anchor-link" href="#Using-a-Custom-Preprocessing-Function">¶</a></h2><p>Left to its own devices <code>CountVectorizer</code> will intelligently tokenize your email to extract individual words to the best of its ability. For more control you can pass it your own preprocessing function which should take in a document (raw email body in this case) and return a processed one. The function we defined in <a href="http://sdsawtelle.github.io/blog/output/spam-classification-text-processing.html">Part I</a>, <code>word_salad()</code> is exactly this kind of preprocessor, and so we could feed our raw email body strings to <code>CountVectorizer</code> instead of our processed ones.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">word_salad</span><span class="p">(</span><span class="n">body</span><span class="p">):</span>
    <span class="sd">'''Produce a word salad from email body.'''</span>    
    <span class="c"># Parse HTML extract content only (but count tags)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    
    <span class="c"># Pull out only the non-markup tex</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

    <span class="c"># Count the number of HTML elements and specific link elements</span>
    <span class="n">nhtml</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">())</span>
    <span class="n">nlinks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">"a"</span><span class="p">))</span>
    <span class="c"># Sub in special strings for "counting"</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="n">nhtml</span><span class="o">*</span><span class="s">" htmltag "</span> <span class="o">+</span> <span class="n">nlinks</span><span class="o">*</span><span class="s">" linktag "</span>
    
    <span class="c"># lowercase everything</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    
    <span class="c"># Replace all URLs with special strings</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"(http|https)://[^\s]*"</span><span class="p">)</span>
    <span class="n">body</span><span class="p">,</span> <span class="n">nhttps</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" httpaddr "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>

    <span class="c"># Replace all email addresses with special strings</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"\b[^\s]+@[^\s]+[.][^\s]+\b"</span><span class="p">)</span>
    <span class="n">body</span><span class="p">,</span> <span class="n">nemails</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" emailaddr "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
    
    <span class="c"># Replace all numbers with special strings</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"\b[\d.]+\b"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" number "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>

    <span class="c"># Replace all $, ! and ? with special strings</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"[$]"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" dollar "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"[!]"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" exclammark "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"[?]"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" questmark "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>

    <span class="c"># Remove all other punctuation (replace with white space)</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"([^\w\s]+)|([_-]+)"</span><span class="p">)</span>  
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
    
    <span class="c"># Replace all newlines and blanklines with special strings</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"\n"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" newline "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"\n\n"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" blankline "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>

    <span class="c"># Make all white space a single space</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r"\s+"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="o">=</span><span class="s">" "</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>

    <span class="c"># Remove any trailing or leading white space</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
 
    <span class="c"># Remove all useless stopwords</span>
    <span class="n">bodywords</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
    <span class="n">keepwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">bodywords</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s">'english'</span><span class="p">)]</span>

    <span class="c"># Stem all words</span>
    <span class="n">stemmer</span> <span class="o">=</span> <span class="n">SnowballStemmer</span><span class="p">(</span><span class="s">"english"</span><span class="p">)</span>
    <span class="n">stemwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span> <span class="k">for</span> <span class="n">wd</span> <span class="ow">in</span> <span class="n">keepwords</span><span class="p">]</span>
    <span class="n">body</span> <span class="o">=</span> <span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stemwords</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">body</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Specify our custom preprocessor and use raw email bodies</span>
<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">=</span><span class="n">word_salad</span><span class="p">,</span> <span class="n">vocabulary</span><span class="o">=</span><span class="n">vocablist</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">emails_raw</span><span class="p">)</span>
<span class="n">X</span> 
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[24]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><3046x877 sparse matrix of type &apos;<class &amp;apos;numpy.int64&amp;apos;>&apos;
	with 150787 stored elements in Compressed Sparse Row format></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Automatic-Vocab-List-Generation">Automatic Vocab List Generation<a class="anchor-link" href="#Automatic-Vocab-List-Generation">¶</a></h2><p><code>CountVectorizer</code> is capable of creating a vocab list for you automatically, based on the criterion of <em>document</em> frequency (the number or proportion of documents that a word appears in). You can set the max and min frequency or proportion using kwargs <code>min_df</code> and <code>max_df</code> (a float is interpreted as proportion of documents). To create the vocab list you must first <code>fit</code> the vectorizer with your corpus, then it can be used to <code>transform</code> the corpus.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [156]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Let vectorizer automatically build a vocab list</span>
<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">min_df</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">max_df</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  
<span class="n">vectorizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">emails_processed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[156]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>CountVectorizer(analyzer=&apos;word&apos;, binary=True, decode_error=&apos;strict&apos;,
        dtype=<class &amp;apos;numpy.int64&amp;apos;>, encoding=&apos;utf-8&apos;,
        input=[&apos;date wed aug chris garrigu messag id cant reproduc error repeat like everi time without fail debug log pick happen pick exec pick inbox list lbrace lbrace subject ftp rbrace rbrace sequenc mercuri exec pick inbox list lbrace lbrace subject ftp rbrace rbrace sequenc mercuri ftoc pickmsg hit m...umber conveni time return call certain happi remov address list click follow link send blank email&apos;],
        lowercase=True, max_df=1.0, max_features=None, min_df=0.03,
        ngram_range=(1, 1), preprocessor=None, stop_words=None,
        strip_accents=None, token_pattern=&apos;(?u)\\b\\w\\w+\\b&apos;,
        tokenizer=None, vocabulary=None)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>vectorizer</code> object now has a vocab list attribut that can be accessed in various ways.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()[</span><span class="mi">10</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[41]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>[&apos;address&apos;, &apos;ago&apos;, &apos;agre&apos;, &apos;allow&apos;, &apos;almost&apos;, &apos;along&apos;, &apos;alreadi&apos;]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">len</span><span class="p">(</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[42]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>591</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Looking-at-Chunks-of-More-than-One-Word-(n-grams)">Looking at Chunks of More than One Word (n-grams)<a class="anchor-link" href="#Looking-at-Chunks-of-More-than-One-Word-(n-grams)">¶</a></h2><p>With <code>CountVectorizer</code> we have to option to include not just individual words in our vocab list but also groups of $n$ contiguous words (n-grams)? This would take us beyond the "bag of words" model because now the position of words in an email matters. The <code>ngram_range</code> kwarg takes a tuple that specifies the smallest group size and largest group size that will be considered.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [92]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">min_df</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">max_df</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">vectorizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">emails_processed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[92]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>CountVectorizer(analyzer=&apos;word&apos;, binary=False, decode_error=&apos;strict&apos;,
        dtype=<class &amp;apos;numpy.int64&amp;apos;>, encoding=&apos;utf-8&apos;,
        input=[&apos;date wed aug chris garrigu messag id cant reproduc error repeat like everi time without fail debug log pick happen pick exec pick inbox list lbrace lbrace subject ftp rbrace rbrace sequenc mercuri exec pick inbox list lbrace lbrace subject ftp rbrace rbrace sequenc mercuri ftoc pickmsg hit m...umber conveni time return call certain happi remov address list click follow link send blank email&apos;],
        lowercase=True, max_df=1.0, max_features=None, min_df=0.03,
        ngram_range=(1, 2), preprocessor=None, stop_words=None,
        strip_accents=None, token_pattern=&apos;(?u)\\b\\w\\w+\\b&apos;,
        tokenizer=None, vocabulary=None)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having specified a maximum n-gram size of two, we should now see single words and word pairs in our fitted vocab list:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [93]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()[</span><span class="mi">143</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[93]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>[&apos;either&apos;, &apos;els&apos;, &apos;email&apos;, &apos;email sponsor&apos;, &apos;encod&apos;, &apos;end&apos;, &apos;end pgp&apos;]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Tranforming-Count-Occurrence-Vectors-to-TF-or-TF-IDF">Tranforming Count Occurrence Vectors to TF or TF-IDF<a class="anchor-link" href="#Tranforming-Count-Occurrence-Vectors-to-TF-or-TF-IDF">¶</a></h1><p>As we said, occurrence count for a word has a lot of drawbacks, but it can be turned into a more robust feature with <code>TfidTransformer</code>. You can ask this tool for just the term-frequencies, or the "Term Frequency times Inverse Document Frequency” (tf-idf). It expects to be passed a matrix of occurrence counts, like that which you get from <code>CountVectorizer</code>, and it will return your the tf or tf-idf transformed matrix of frequencies.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="k">import</span> <span class="n">TfidfTransformer</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tf_transformer</span> <span class="o">=</span> <span class="n">TfidfTransformer</span><span class="p">(</span><span class="n">use_idf</span><span class="o">=</span><span class="k">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_tf</span> <span class="o">=</span> <span class="n">tf_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tf</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>  <span class="c"># term frequency of 30th vocab word in the 30th email</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[25]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>0.080669648511006734</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tfidf_transformer</span> <span class="o">=</span> <span class="n">TfidfTransformer</span><span class="p">(</span><span class="n">use_idf</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_tfidf</span> <span class="o">=</span> <span class="n">tfidf_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tfidf</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>  <span class="c"># term freqn - inverse doc freqn of 30th vocab word in the 30th email</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[27]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>0.29097091996720964</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Optimizing-Over-Preprocessers-with-Pipeline-and-GridSearchCV">Optimizing Over Preprocessers with <code>Pipeline</code> and <code>GridSearchCV</code><a class="anchor-link" href="#Optimizing-Over-Preprocessers-with-Pipeline-and-GridSearchCV">¶</a></h1><p>Clearly some uncertainty still remains in what is the best way to proceed with vectorization:</p>
<ul>
<li>What words should be included in this vocab list?</li>
<li>Should the numeric feature be binary occurrence, tf, or tf-idf?</li>
<li>Should we use only words in our vocab list, or also include groups of $n$ contiguous words (n-grams)?</li>
</ul>
<p>All of the above questions have to do with <em>preprocessing</em> of the data into the numeric vectors rather than with the SVM algorithm itself. To compare the performance of an algorithm under different preprocessing options in sklearn we can use a <code>Pipeline</code>: a chain of sklearn objects which transforms (or fits) your data sequentially. Once the pipeline is created, <code>GridSearchCV</code> can be used to vary parameters of any step in the pipeline.</p>
<p>A pipeline has its own <code>fit</code> method that results in the full sequence of transformations being executed ending with a fit of the final estimator in the pipeline. I'll be using a support vector machine as my final estimator, you can take a look at another of my posts if you want to learn more about <a href="http://sdsawtelle.github.io/blog/output/week7-andrew-ng-machine-learning-with-python.html">SVMs and Grid Search in python</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="k">import</span> <span class="n">Pipeline</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You initialize a pipeline by providing it with every object in the pipeline, each of which you give a nickname to:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Define component objects of our pipeline then create it!</span>
<span class="n">objs</span> <span class="o">=</span> <span class="p">[(</span><span class="s">"vect"</span><span class="p">,</span> <span class="n">CountVectorizer</span><span class="p">()),</span> 
        <span class="p">(</span><span class="s">"tfidf"</span><span class="p">,</span> <span class="n">TfidfTransformer</span><span class="p">()),</span>
        <span class="p">(</span><span class="s">"svm"</span><span class="p">,</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">"rbf"</span><span class="p">))]</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">named_steps</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[8]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>{&apos;svm&apos;: SVC(C=1.0, cache_size=200, class_weight=None, coef0=0.0,
   decision_function_shape=None, degree=3, gamma=&apos;auto&apos;, kernel=&apos;rbf&apos;,
   max_iter=-1, probability=False, random_state=None, shrinking=True,
   tol=0.001, verbose=False),
 &apos;tfidf&apos;: TfidfTransformer(norm=&apos;l2&apos;, smooth_idf=True, sublinear_tf=False, use_idf=True),
 &apos;vect&apos;: CountVectorizer(analyzer=&apos;word&apos;, binary=False, decode_error=&apos;strict&apos;,
         dtype=<class &amp;apos;numpy.int64&amp;apos;>, encoding=&apos;utf-8&apos;, input=&apos;content&apos;,
         lowercase=True, max_df=1.0, max_features=None, min_df=1,
         ngram_range=(1, 1), preprocessor=None, stop_words=None,
         strip_accents=None, token_pattern=&apos;(?u)\\b\\w\\w+\\b&apos;,
         tokenizer=None, vocabulary=None)}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To conduct the grid search on the parameter space we'll need to pass <code>GridSearchCV</code> the pipeline we just created, as well as a specification of what parameters of the different objects we will be varying, and over what range. Within the vectorizer we will try different minimum frequencies as our vocab list cutoff and n-grams of different sizes. Within the tf-idf transformer we'll try including vs. not including inverse document frequency. Within the SVM we will want to optimize over the inverse regularization, C, as well as the spread parameter of the guassian kernel, gamma.</p>
<p>First I'll try a smaller subset of these parameter values, to avoid running a long computation. To refer to a specific parameters of a specific step in the pipeline you use <code><estimator nickname>__<parameter></code> syntax:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Specify parameters of the pipeline and their ranges for grid search</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'vect__min_df'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s">'vect__ngram_range'</span><span class="p">:</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>  <span class="c"># unigrams or bigrams</span>
    <span class="s">'tfidf__use_idf'</span><span class="p">:</span> <span class="p">(</span><span class="k">True</span><span class="p">,</span> <span class="k">False</span><span class="p">),</span>
    <span class="s">'svm__C'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s">'svm__gamma'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">}</span>

<span class="c"># Construct our grid search object</span>
<span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The grid search object is induced to actually perform the search by the <code>fit</code> method, the results can then be inspected. When running the algorithm at each point in your parameter space grid this guy will do 3-fold cross-validation (you can change the fold number with kwarg <code>cv</code>).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">emails_processed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[14]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>GridSearchCV(cv=None, error_score=&apos;raise&apos;,
       estimator=Pipeline(steps=[(&apos;vect&apos;, CountVectorizer(analyzer=&apos;word&apos;, binary=False, decode_error=&apos;strict&apos;,
        dtype=<class &amp;apos;numpy.int64&amp;apos;>, encoding=&apos;utf-8&apos;, input=&apos;content&apos;,
        lowercase=True, max_df=1.0, max_features=None, min_df=1,
        ngram_range=(1, 1), preprocessor=None, stop_words=None,
        strip...,
  max_iter=-1, probability=False, random_state=None, shrinking=True,
  tol=0.001, verbose=False))]),
       fit_params={}, iid=True, n_jobs=1,
       param_grid={&apos;vect__min_df&apos;: array([ 0.005  ,  0.01625,  0.0275 ,  0.03875,  0.05   ]), &apos;vect__ngram_range&apos;: ((1, 1), (1, 2)), &apos;svm__gamma&apos;: array([  0.1    ,   0.16681,   0.27826,   0.46416,   0.77426,   1.29155,
         2.15443,   3.59381,   5.99484,  10.     ]), &apos;tfidf__use_idf&apos;: (True, False), &apos;svm__C&apos;: array([   0.1    ,    0.21544,    0.46416,    1.     ,    2.15443,
          4.64159,   10.     ,   21.54435,   46.41589,  100.     ])},
       pre_dispatch=&apos;2*n_jobs&apos;, refit=True, return_train_score=True,
       scoring=None, verbose=0)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">print</span><span class="p">(</span><span class="s">"Best parameter values:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Best parameter values:
(&apos;vect__min_df&apos;, 0.0050000000000000001)
(&apos;vect__ngram_range&apos;, (1, 2))
(&apos;svm__gamma&apos;, 2.1544346900318834)
(&apos;tfidf__use_idf&apos;, False)
(&apos;svm__C&apos;, 2.1544346900318834)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">print</span><span class="p">(</span><span class="s">"CV Score using best parameter values:"</span><span class="p">,</span> <span class="n">search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CV Score using best parameter values: 0.983585029547
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The scoring metric here is the default scoring method for the final estimator: in this case it's classification accuracy. We're doing pretty well, at 98% of emails correctly classified. It seems that using a large number of vocab words (<code>min_df=0.02</code>) and using the idf weighting (<code>use_idf=True</code>) gave us the best performance.</p>
</div>
</div>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

    </article>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Blog powered by <a href="http://getpelican.com">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="./theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="./theme/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="./theme/js/clean-blog.min.js"></script>

</body>

</html>